log_m2 = """
Start DCC:
parallelisation=Sequential(local vmap, device=TFRT_CPU_0)
Make SLP N=1 active.
Make SLP N=2 active.
Make SLP N=3 active.
Make SLP N=4 active.
Make SLP N=5 active.
Make SLP N=6 active.
Make SLP N=7 active.
Make SLP N=8 active.
Make SLP N=9 active.
Make SLP N=10 active.
Make SLP N=11 active.
Make SLP N=12 active.
Make SLP N=13 active.
Make SLP N=14 active.
Make SLP N=15 active.
Make SLP N=16 active.
Make SLP N=17 active.
Make SLP N=18 active.
Make SLP N=19 active.
Make SLP N=20 active.
Make SLP N=21 active.
Make SLP N=22 active.
Make SLP N=23 active.
Make SLP N=24 active.
Initialised SLPs in 1.979s.
Computed supports in 0.040s                                                                                                                                                                                                                                                                                               
Factors size: 34                                                                                                                                                                                                                                                                                                          
Computed elimination order in 0.000s                                                                                                                                                                                                                                                                                      
Finished inference task for N=1 in 0.297s                                                                                                                                                                                                                                                                                 
Finished logweight estimation task for N=1 in 0.000s                                                                                                                                                                                                                                                                      
Computed supports in 0.004s                                                                                                                                                                                                                                                                                               
Factors size: 106                                                                                                                                                                                                                                                                                                         
Computed elimination order in 0.000s                                                                                                                                                                                                                                                                                      
Finished inference task for N=2 in 0.238s                                                                                                                                                                                                                                                                                 
Finished logweight estimation task for N=2 in 0.000s                                                                                                                                                                                                                                                                      
Computed supports in 0.012s                                                                                                                                                                                                                                                                                               
Factors size: 278                                                                                                                                                                                                                                                                                                         
Computed elimination order in 0.000s                                                                                                                                                                                                                                                                                      
Finished inference task for N=3 in 0.277s                                                                                                                                                                                                                                                                                 
Finished logweight estimation task for N=3 in 0.000s                                                                                                                                                                                                                                                                      
Computed supports in 0.012s                                                                                                                                                                                                                                                                                               
Factors size: 690                                                                                                                                                                                                                                                                                                         
Computed elimination order in 0.000s                                                                                                                                                                                                                                                                                      
Finished inference task for N=4 in 0.286s                                                                                                                                                                                                                                                                                 
Finished logweight estimation task for N=4 in 0.000s                                                                                                                                                                                                                                                                      
Computed supports in 0.012s                                                                                                                                                                                                                                                                                               
Factors size: 1,662                                                                                                                                                                                                                                                                                                       
Computed elimination order in 0.000s                                                                                                                                                                                                                                                                                      
Finished inference task for N=5 in 0.301s                                                                                                                                                                                                                                                                                 
Finished logweight estimation task for N=5 in 0.000s                                                                                                                                                                                                                                                                      
Computed supports in 0.012s                                                                                                                                                                                                                                                                                               
Factors size: 3,914                                                                                                                                                                                                                                                                                                       
Computed elimination order in 0.001s                                                                                                                                                                                                                                                                                      
Finished inference task for N=6 in 0.338s                                                                                                                                                                                                                                                                                 
Finished logweight estimation task for N=6 in 0.000s                                                                                                                                                                                                                                                                      
Computed supports in 0.013s                                                                                                                                                                                                                                                                                               
Factors size: 9,046                                                                                                                                                                                                                                                                                                       
Computed elimination order in 0.001s                                                                                                                                                                                                                                                                                      
Finished inference task for N=7 in 0.340s                                                                                                                                                                                                                                                                                 
Finished logweight estimation task for N=7 in 0.000s                                                                                                                                                                                                                                                                      
Computed supports in 0.013s                                                                                                                                                                                                                                                                                               
Factors size: 20,578                                                                                                                                                                                                                                                                                                      
Computed elimination order in 0.001s                                                                                                                                                                                                                                                                                      
Finished inference task for N=8 in 0.396s                                                                                                                                                                                                                                                                                 
Finished logweight estimation task for N=8 in 0.000s                                                                                                                                                                                                                                                                      
Computed supports in 0.013s                                                                                                                                                                                                                                                                                               
Factors size: 46,190                                                                                                                                                                                                                                                                                                      
Computed elimination order in 0.001s                                                                                                                                                                                                                                                                                      
Finished inference task for N=9 in 0.376s                                                                                                                                                                                                                                                                                 
Finished logweight estimation task for N=9 in 0.000s                                                                                                                                                                                                                                                                      
Computed supports in 0.013s                                                                                                                                                                                                                                                                                               
Factors size: 102,522                                                                                                                                                                                                                                                                                                     
Computed elimination order in 0.001s                                                                                                                                                                                                                                                                                      
Finished inference task for N=10 in 0.405s                                                                                                                                                                                                                                                                                
Finished logweight estimation task for N=10 in 0.000s                                                                                                                                                                                                                                                                     
Computed supports in 0.015s                                                                                                                                                                                                                                                                                               
Factors size: 225,414                                                                                                                                                                                                                                                                                                     
Computed elimination order in 0.001s                                                                                                                                                                                                                                                                                      
Finished inference task for N=11 in 0.422s                                                                                                                                                                                                                                                                                
Finished logweight estimation task for N=11 in 0.000s                                                                                                                                                                                                                                                                     
Computed supports in 0.015s                                                                                                                                                                                                                                                                                               
Factors size: 491,666                                                                                                                                                                                                                                                                                                     
Computed elimination order in 0.001s                                                                                                                                                                                                                                                                                      
Finished inference task for N=12 in 0.442s                                                                                                                                                                                                                                                                                
Finished logweight estimation task for N=12 in 0.000s                                                                                                                                                                                                                                                                     
Computed supports in 0.015s                                                                                                                                                                                                                                                                                               
Factors size: 1,065,118                                                                                                                                                                                                                                                                                                   
Computed elimination order in 0.001s                                                                                                                                                                                                                                                                                      
Finished inference task for N=13 in 0.483s                                                                                                                                                                                                                                                                                
Finished logweight estimation task for N=13 in 0.000s                                                                                                                                                                                                                                                                     
Computed supports in 0.015s                                                                                                                                                                                                                                                                                               
Factors size: 2,293,930                                                                                                                                                                                                                                                                                                   
Computed elimination order in 0.002s                                                                                                                                                                                                                                                                                      
Finished inference task for N=14 in 0.606s                                                                                                                                                                                                                                                                                
Finished logweight estimation task for N=14 in 0.000s                                                                                                                                                                                                                                                                     
Computed supports in 0.015s                                                                                                                                                                                                                                                                                               
Factors size: 4,915,382                                                                                                                                                                                                                                                                                                   
Computed elimination order in 0.002s                                                                                                                                                                                                                                                                                      
Finished inference task for N=15 in 0.610s                                                                                                                                                                                                                                                                                
Finished logweight estimation task for N=15 in 0.000s                                                                                                                                                                                                                                                                     
Computed supports in 0.015s                                                                                                                                                                                                                                                                                               
Factors size: 10,485,954                                                                                                                                                                                                                                                                                                  
Computed elimination order in 0.002s                                                                                                                                                                                                                                                                                      
Finished inference task for N=16 in 0.542s                                                                                                                                                                                                                                                                                
Finished logweight estimation task for N=16 in 0.000s                                                                                                                                                                                                                                                                     
Computed supports in 0.016s                                                                                                                                                                                                                                                                                               
Factors size: 22,282,446                                                                                                                                                                                                                                                                                                  
Computed elimination order in 0.002s                                                                                                                                                                                                                                                                                      
Finished inference task for N=17 in 0.771s                                                                                                                                                                                                                                                                                
Finished logweight estimation task for N=17 in 0.000s                                                                                                                                                                                                                                                                     
Computed supports in 0.015s                                                                                                                                                                                                                                                                                               
Factors size: 47,186,138                                                                                                                                                                                                                                                                                                  
Computed elimination order in 0.003s                                                                                                                                                                                                                                                                                      
Finished inference task for N=18 in 0.823s                                                                                                                                                                                                                                                                                
Finished logweight estimation task for N=18 in 0.000s                                                                                                                                                                                                                                                                     
Computed supports in 0.016s                                                                                                                                                                                                                                                                                               
Factors size: 99,614,950                                                                                                                                                                                                                                                                                                  
Computed elimination order in 0.003s                                                                                                                                                                                                                                                                                      
Finished inference task for N=19 in 1.053s                                                                                                                                                                                                                                                                                
Finished logweight estimation task for N=19 in 0.000s                                                                                                                                                                                                                                                                     
Computed supports in 0.015s                                                                                                                                                                                                                                                                                               
Factors size: 209,715,442                                                                                                                                                                                                                                                                                                 
Computed elimination order in 0.003s                                                                                                                                                                                                                                                                                      
Finished inference task for N=20 in 1.191s                                                                                                                                                                                                                                                                                
Finished logweight estimation task for N=20 in 0.000s                                                                                                                                                                                                                                                                     
Computed supports in 0.017s                                                                                                                                                                                                                                                                                               
Factors size: 440,402,174                                                                                                                                                                                                                                                                                                 
Computed elimination order in 0.003s                                                                                                                                                                                                                                                                                      
Finished inference task for N=21 in 1.844s                                                                                                                                                                                                                                                                                
Finished logweight estimation task for N=21 in 0.000s                                                                                                                                                                                                                                                                     
Computed supports in 0.017s                                                                                                                                                                                                                                                                                               
Factors size: 922,747,146                                                                                                                                                                                                                                                                                                 
Computed elimination order in 0.004s                                                                                                                                                                                                                                                                                      
Finished inference task for N=22 in 4.917s                                                                                                                                                                                                                                                                                
Finished logweight estimation task for N=22 in 0.000s                                                                                                                                                                                                                                                                     
Computed supports in 0.048s                                                                                                                                                                                                                                                                                               
Factors size: 1,929,380,118                                                                                                                                                                                                                                                                                               
Computed elimination order in 0.004s                                                                                                                                                                                                                                                                                      
Finished inference task for N=23 in 11.958s                                                                                                                                                                                                                                                                               
Finished logweight estimation task for N=23 in 0.000s                                                                                                                                                                                                                                                                     
Computed supports in 0.037s                                                                                                                                                                                                                                                                                               
Factors size: 4,026,532,130                                                                                                                                                                                                                                                                                               
Computed elimination order in 0.005s                                                                                                                                                                                                                                                                                      
Finished inference task for N=24 in 29.583s                                                                                                                                                                                                                                                                               
Finished logweight estimation task for N=24 in 0.001s                                                                                                                                                                                                                                                                     
Finished iteration 1 in 59.382s.                                                                                                                                                                                                                                                                                          
Finished DCC in 61.362s.                                                                                                                                                                                                                                                                                                  
Inference time: 58.499s, logweight estimate time: 0.002s                                                                                                                                                                                                                                                                  
cpu usage 2.8/10 wall_time:61.4s                                                                                                                                                                                                                                                                                          
Total jit time: 17.116s (27.89%)    (trace=6.833s, lower=1.521s, compile=8.763s)
Exact-DCCResult {
        N=1: Factor([], ()) with prob=0.002140, log_Z=-13.371147
        N=2: Factor([], ()) with prob=0.033102, log_Z=-10.632256
        N=3: Factor([], ()) with prob=0.076329, log_Z=-9.796787
        N=4: Factor([], ()) with prob=0.125624, log_Z=-9.298538
        N=5: Factor([], ()) with prob=0.160147, log_Z=-9.055743
        N=6: Factor([], ()) with prob=0.167114, log_Z=-9.013157
        N=7: Factor([], ()) with prob=0.147853, log_Z=-9.135615
        N=8: Factor([], ()) with prob=0.113645, log_Z=-9.398753
        N=9: Factor([], ()) with prob=0.077262, log_Z=-9.784631
        N=10: Factor([], ()) with prob=0.047105, log_Z=-10.279446
        N=11: Factor([], ()) with prob=0.026039, log_Z=-10.872242
        N=12: Factor([], ()) with prob=0.013167, log_Z=-11.554102
        N=13: Factor([], ()) with prob=0.006136, log_Z=-12.317615
        N=14: Factor([], ()) with prob=0.002652, log_Z=-13.156527
        N=15: Factor([], ()) with prob=0.001069, log_Z=-14.065472
        N=16: Factor([], ()) with prob=0.000403, log_Z=-15.039820
        N=17: Factor([], ()) with prob=0.000143, log_Z=-16.075506
        N=18: Factor([], ()) with prob=0.000048, log_Z=-17.168951
        N=19: Factor([], ()) with prob=0.000015, log_Z=-18.316986
        N=20: Factor([], ()) with prob=0.000005, log_Z=-19.516750
        N=21: Factor([], ()) with prob=0.000001, log_Z=-20.765684
        N=22: Factor([], ()) with prob=0.000000, log_Z=-22.061474
        N=23: Factor([], ()) with prob=0.000000, log_Z=-23.402000
        N=24: Factor([], ()) with prob=0.000000, log_Z=-24.785345
}
"""

log_cpu = """
Start DCC:
parallelisation=Sequential(local vmap, device=TFRT_CPU_0)
Make SLP N=1 active.
Make SLP N=2 active.
Make SLP N=3 active.
Make SLP N=4 active.
Make SLP N=5 active.
Make SLP N=6 active.
Make SLP N=7 active.
Make SLP N=8 active.
Make SLP N=9 active.
Make SLP N=10 active.
Make SLP N=11 active.
Make SLP N=12 active.
Make SLP N=13 active.
Make SLP N=14 active.
Make SLP N=15 active.
Make SLP N=16 active.
Make SLP N=17 active.
Make SLP N=18 active.
Make SLP N=19 active.
Make SLP N=20 active.
Make SLP N=21 active.
Make SLP N=22 active.
Make SLP N=23 active.
Make SLP N=24 active.
Make SLP N=25 active.
Initialised SLPs in 1.939s.
Computed supports in 0.047s                                                                                                                                                                                            
Factors size: 34                                                                                                                                                                                                       
Computed elimination order in 0.000s                                                                                                                                                                                   
Finished inference task for N=1 in 0.306s                                                                                                                                                                              
Finished logweight estimation task for N=1 in 0.000s                                                                                                                                                                   
Computed supports in 0.003s                                                                                                                                                                                            
Factors size: 106                                                                                                                                                                                                      
Computed elimination order in 0.000s                                                                                                                                                                                   
Finished inference task for N=2 in 0.219s                                                                                                                                                                              
Finished logweight estimation task for N=2 in 0.000s                                                                                                                                                                   
Computed supports in 0.013s                                                                                                                                                                                            
Factors size: 278                                                                                                                                                                                                      
Computed elimination order in 0.000s                                                                                                                                                                                   
Finished inference task for N=3 in 0.255s                                                                                                                                                                              
Finished logweight estimation task for N=3 in 0.000s                                                                                                                                                                   
Computed supports in 0.013s                                                                                                                                                                                            
Factors size: 690                                                                                                                                                                                                      
Computed elimination order in 0.000s                                                                                                                                                                                   
Finished inference task for N=4 in 0.256s                                                                                                                                                                              
Finished logweight estimation task for N=4 in 0.000s                                                                                                                                                                   
Computed supports in 0.013s                                                                                                                                                                                            
Factors size: 1,662                                                                                                                                                                                                    
Computed elimination order in 0.000s                                                                                                                                                                                   
Finished inference task for N=5 in 0.274s                                                                                                                                                                              
Finished logweight estimation task for N=5 in 0.000s                                                                                                                                                                   
Computed supports in 0.014s                                                                                                                                                                                            
Factors size: 3,914                                                                                                                                                                                                    
Computed elimination order in 0.000s                                                                                                                                                                                   
Finished inference task for N=6 in 0.307s                                                                                                                                                                              
Finished logweight estimation task for N=6 in 0.000s                                                                                                                                                                   
Computed supports in 0.014s                                                                                                                                                                                            
Factors size: 9,046                                                                                                                                                                                                    
Computed elimination order in 0.000s                                                                                                                                                                                   
Finished inference task for N=7 in 0.317s                                                                                                                                                                              
Finished logweight estimation task for N=7 in 0.000s                                                                                                                                                                   
Computed supports in 0.014s                                                                                                                                                                                            
Factors size: 20,578                                                                                                                                                                                                   
Computed elimination order in 0.001s                                                                                                                                                                                   
Finished inference task for N=8 in 0.394s                                                                                                                                                                              
Finished logweight estimation task for N=8 in 0.000s                                                                                                                                                                   
Computed supports in 0.013s                                                                                                                                                                                            
Factors size: 46,190                                                                                                                                                                                                   
Computed elimination order in 0.001s                                                                                                                                                                                   
Finished inference task for N=9 in 0.376s                                                                                                                                                                              
Finished logweight estimation task for N=9 in 0.000s                                                                                                                                                                   
Computed supports in 0.014s                                                                                                                                                                                            
Factors size: 102,522                                                                                                                                                                                                  
Computed elimination order in 0.001s                                                                                                                                                                                   
Finished inference task for N=10 in 0.415s                                                                                                                                                                             
Finished logweight estimation task for N=10 in 0.000s                                                                                                                                                                  
Computed supports in 0.015s                                                                                                                                                                                            
Factors size: 225,414                                                                                                                                                                                                  
Computed elimination order in 0.001s                                                                                                                                                                                   
Finished inference task for N=11 in 0.466s                                                                                                                                                                             
Finished logweight estimation task for N=11 in 0.000s                                                                                                                                                                  
Computed supports in 0.015s                                                                                                                                                                                            
Factors size: 491,666                                                                                                                                                                                                  
Computed elimination order in 0.001s                                                                                                                                                                                   
Finished inference task for N=12 in 0.431s                                                                                                                                                                             
Finished logweight estimation task for N=12 in 0.000s                                                                                                                                                                  
Computed supports in 0.015s                                                                                                                                                                                            
Factors size: 1,065,118                                                                                                                                                                                                
Computed elimination order in 0.001s                                                                                                                                                                                   
Finished inference task for N=13 in 0.510s                                                                                                                                                                             
Finished logweight estimation task for N=13 in 0.000s                                                                                                                                                                  
Computed supports in 0.014s                                                                                                                                                                                            
Factors size: 2,293,930                                                                                                                                                                                                
Computed elimination order in 0.001s                                                                                                                                                                                   
Finished inference task for N=14 in 0.601s                                                                                                                                                                             
Finished logweight estimation task for N=14 in 0.000s                                                                                                                                                                  
Computed supports in 0.015s                                                                                                                                                                                            
Factors size: 4,915,382                                                                                                                                                                                                
Computed elimination order in 0.001s                                                                                                                                                                                   
Finished inference task for N=15 in 0.604s                                                                                                                                                                             
Finished logweight estimation task for N=15 in 0.000s                                                                                                                                                                  
Computed supports in 0.016s                                                                                                                                                                                            
Factors size: 10,485,954                                                                                                                                                                                               
Computed elimination order in 0.001s                                                                                                                                                                                   
Finished inference task for N=16 in 0.528s                                                                                                                                                                             
Finished logweight estimation task for N=16 in 0.000s                                                                                                                                                                  
Computed supports in 0.015s                                                                                                                                                                                            
Factors size: 22,282,446                                                                                                                                                                                               
Computed elimination order in 0.002s                                                                                                                                                                                   
Finished inference task for N=17 in 0.779s                                                                                                                                                                             
Finished logweight estimation task for N=17 in 0.000s                                                                                                                                                                  
Computed supports in 0.015s                                                                                                                                                                                            
Factors size: 47,186,138                                                                                                                                                                                               
Computed elimination order in 0.002s                                                                                                                                                                                   
Finished inference task for N=18 in 0.903s                                                                                                                                                                             
Finished logweight estimation task for N=18 in 0.000s                                                                                                                                                                  
Computed supports in 0.015s                                                                                                                                                                                            
Factors size: 99,614,950                                                                                                                                                                                               
Computed elimination order in 0.002s                                                                                                                                                                                   
Finished inference task for N=19 in 1.102s                                                                                                                                                                             
Finished logweight estimation task for N=19 in 0.000s                                                                                                                                                                  
Computed supports in 0.016s                                                                                                                                                                                            
Factors size: 209,715,442                                                                                                                                                                                              
Computed elimination order in 0.002s                                                                                                                                                                                   
Finished inference task for N=20 in 1.134s                                                                                                                                                                             
Finished logweight estimation task for N=20 in 0.000s                                                                                                                                                                  
Computed supports in 0.016s                                                                                                                                                                                            
Factors size: 440,402,174                                                                                                                                                                                              
Computed elimination order in 0.002s                                                                                                                                                                                   
Finished inference task for N=21 in 1.525s                                                                                                                                                                             
Finished logweight estimation task for N=21 in 0.000s                                                                                                                                                                  
Computed supports in 0.018s                                                                                                                                                                                            
Factors size: 922,747,146                                                                                                                                                                                              
Computed elimination order in 0.002s                                                                                                                                                                                   
Finished inference task for N=22 in 2.764s                                                                                                                                                                             
Finished logweight estimation task for N=22 in 0.000s                                                                                                                                                                  
Computed supports in 0.017s                                                                                                                                                                                            
Factors size: 1,929,380,118                                                                                                                                                                                            
Computed elimination order in 0.003s                                                                                                                                                                                   
Finished inference task for N=23 in 4.881s                                                                                                                                                                             
Finished logweight estimation task for N=23 in 0.000s                                                                                                                                                                  
Computed supports in 0.017s                                                                                                                                                                                            
Factors size: 4,026,532,130                                                                                                                                                                                            
Computed elimination order in 0.003s                                                                                                                                                                                   
Finished inference task for N=24 in 10.727s                                                                                                                                                                            
Finished logweight estimation task for N=24 in 0.000s                                                                                                                                                                  
Computed supports in 0.016s                                                                                                                                                                                            
Factors size: 8,388,608,302                                                                                                                                                                                            
Computed elimination order in 0.003s                                                                                                                                                                                   
Finished inference task for N=25 in 16.522s                                                                                                                                                                            
Finished logweight estimation task for N=25 in 0.000s                                                                                                                                                                  
Finished iteration 1 in 47.491s.                                                                                                                                                                                       
Finished DCC in 49.431s.                                                                                                                                                                                               
Inference time: 46.595s, logweight estimate time: 0.001s                                                                                                                                                               
cpu usage 3.4/8 wall_time:49.4s                                                                                                                                                                                        
Total jit time: 18.678s (37.78%)    (trace=7.164s, lower=1.487s, compile=10.026s)
Exact-DCCResult {
	N=1: Factor([], ()) with prob=0.002140, log_Z=-13.371147
	N=2: Factor([], ()) with prob=0.033102, log_Z=-10.632256
	N=3: Factor([], ()) with prob=0.076329, log_Z=-9.796787
	N=4: Factor([], ()) with prob=0.125624, log_Z=-9.298538
	N=5: Factor([], ()) with prob=0.160147, log_Z=-9.055743
	N=6: Factor([], ()) with prob=0.167114, log_Z=-9.013157
	N=7: Factor([], ()) with prob=0.147853, log_Z=-9.135615
	N=8: Factor([], ()) with prob=0.113645, log_Z=-9.398753
	N=9: Factor([], ()) with prob=0.077262, log_Z=-9.784631
	N=10: Factor([], ()) with prob=0.047105, log_Z=-10.279445
	N=11: Factor([], ()) with prob=0.026039, log_Z=-10.872242
	N=12: Factor([], ()) with prob=0.013167, log_Z=-11.554102
	N=13: Factor([], ()) with prob=0.006136, log_Z=-12.317615
	N=14: Factor([], ()) with prob=0.002652, log_Z=-13.156527
	N=15: Factor([], ()) with prob=0.001069, log_Z=-14.065473
	N=16: Factor([], ()) with prob=0.000403, log_Z=-15.039820
	N=17: Factor([], ()) with prob=0.000143, log_Z=-16.075508
	N=18: Factor([], ()) with prob=0.000048, log_Z=-17.168951
	N=19: Factor([], ()) with prob=0.000015, log_Z=-18.316986
	N=20: Factor([], ()) with prob=0.000005, log_Z=-19.516750
	N=21: Factor([], ()) with prob=0.000001, log_Z=-20.765684
	N=22: Factor([], ()) with prob=0.000000, log_Z=-22.061474
	N=23: Factor([], ()) with prob=0.000000, log_Z=-23.402000
	N=24: Factor([], ()) with prob=0.000000, log_Z=-24.785345
	N=25: Factor([], ()) with prob=0.000000, log_Z=-26.209732
}

[2.13974621e-03 3.31015103e-02 7.63285607e-02 1.25624359e-01
 1.60146847e-01 1.67114228e-01 1.47853076e-01 1.13645196e-01
 7.72621036e-02 4.71054986e-02 2.60389224e-02 1.31672472e-02
 6.13628700e-03 2.65198341e-03 1.06861326e-03 4.03336016e-04
 1.43176992e-04 4.79730152e-05 1.52198973e-05 4.58522572e-06
 1.31509057e-06 3.59916157e-07 9.41928704e-08 2.36177815e-08
 5.68375969e-09]
vs
[2.1397418e-03 3.3101458e-02 7.6328598e-02 1.2562428e-01 1.6014688e-01
 1.6711420e-01 1.4785285e-01 1.1364499e-01 7.7262253e-02 4.7105588e-02
 2.6038950e-02 1.3167242e-02 6.1362768e-03 2.6519878e-03 1.0686144e-03
 4.0333698e-04 1.4317746e-04 4.7972830e-05 1.5219902e-05 4.5852253e-06
 1.3150883e-06 3.5991673e-07 9.4192885e-08 2.3617826e-08 5.6837495e-09]
Max err:  2.2351742e-07
"""

log_l40s = """
Start DCC:
parallelisation=Sequential(local vmap, device=cuda:0)
Make SLP N=1 active.
Make SLP N=2 active.
Make SLP N=3 active.
Make SLP N=4 active.
Make SLP N=5 active.
Make SLP N=6 active.
Make SLP N=7 active.
Make SLP N=8 active.
Make SLP N=9 active.
Make SLP N=10 active.
Make SLP N=11 active.
Make SLP N=12 active.
Make SLP N=13 active.
Make SLP N=14 active.
Make SLP N=15 active.
Make SLP N=16 active.
Make SLP N=17 active.
Make SLP N=18 active.
Make SLP N=19 active.
Make SLP N=20 active.
Make SLP N=21 active.
Make SLP N=22 active.
Make SLP N=23 active.
Make SLP N=24 active.
Make SLP N=25 active.
Initialised SLPs in 6.331s.
Computed supports in 0.139s                                                                                                                                                                                            
Computed factors in 0.565s                                                                                                                                                                                             
Factors size: 34                                                                                                                                                                                                       
Computed elimination order in 0.000s                                                                                                                                                                                   
Performed variable_elimination in 0.245s                                                                                                                                                                               
Log-evidence: -13.371148                                                                                                                                                                                               
Finished inference task for N=1 in 0.814s                                                                                                                                                                              
Finished logweight estimation task for N=1 in 0.000s                                                                                                                                                                   
Computed supports in 0.014s                                                                                                                                                                                            
Computed factors in 0.654s                                                                                                                                                                                             
Factors size: 106                                                                                                                                                                                                      
Computed elimination order in 0.000s                                                                                                                                                                                   
Performed variable_elimination in 0.253s                                                                                                                                                                               
Log-evidence: -10.632257                                                                                                                                                                                               
Finished inference task for N=2 in 0.911s                                                                                                                                                                              
Finished logweight estimation task for N=2 in 0.000s                                                                                                                                                                   
Computed supports in 0.046s                                                                                                                                                                                            
Computed factors in 0.765s                                                                                                                                                                                             
Factors size: 278                                                                                                                                                                                                      
Computed elimination order in 0.000s                                                                                                                                                                                   
Performed variable_elimination in 0.201s                                                                                                                                                                               
Log-evidence: -9.796787                                                                                                                                                                                                
Finished inference task for N=3 in 0.970s                                                                                                                                                                              
Finished logweight estimation task for N=3 in 0.000s                                                                                                                                                                   
Computed supports in 0.042s                                                                                                                                                                                            
Computed factors in 0.856s                                                                                                                                                                                             
Factors size: 690                                                                                                                                                                                                      
Computed elimination order in 0.000s                                                                                                                                                                                   
Performed variable_elimination in 0.222s                                                                                                                                                                               
Log-evidence: -9.298538                                                                                                                                                                                                
Finished inference task for N=4 in 1.084s                                                                                                                                                                              
Finished logweight estimation task for N=4 in 0.000s                                                                                                                                                                   
Computed supports in 0.047s                                                                                                                                                                                            
Computed factors in 0.991s                                                                                                                                                                                             
Factors size: 1,662                                                                                                                                                                                                    
Computed elimination order in 0.000s                                                                                                                                                                                   
Performed variable_elimination in 0.257s                                                                                                                                                                               
Log-evidence: -9.055743                                                                                                                                                                                                
Finished inference task for N=5 in 1.253s                                                                                                                                                                              
Finished logweight estimation task for N=5 in 0.000s                                                                                                                                                                   
Computed supports in 0.046s                                                                                                                                                                                            
Computed factors in 1.075s                                                                                                                                                                                             
Factors size: 3,914                                                                                                                                                                                                    
Computed elimination order in 0.000s                                                                                                                                                                                   
Performed variable_elimination in 0.275s                                                                                                                                                                               
Log-evidence: -9.013157                                                                                                                                                                                                
Finished inference task for N=6 in 1.355s                                                                                                                                                                              
Finished logweight estimation task for N=6 in 0.000s                                                                                                                                                                   
Computed supports in 0.047s                                                                                                                                                                                            
Computed factors in 1.198s                                                                                                                                                                                             
Factors size: 9,046                                                                                                                                                                                                    
Computed elimination order in 0.001s                                                                                                                                                                                   
Performed variable_elimination in 0.312s                                                                                                                                                                               
Log-evidence: -9.135618                                                                                                                                                                                                
Finished inference task for N=7 in 1.516s                                                                                                                                                                              
Finished logweight estimation task for N=7 in 0.000s                                                                                                                                                                   
Computed supports in 0.043s                                                                                                                                                                                            
Computed factors in 1.298s                                                                                                                                                                                             
Factors size: 20,578                                                                                                                                                                                                   
Computed elimination order in 0.001s                                                                                                                                                                                   
Performed variable_elimination in 0.286s                                                                                                                                                                               
Log-evidence: -9.398754                                                                                                                                                                                                
Finished inference task for N=8 in 1.590s                                                                                                                                                                              
Finished logweight estimation task for N=8 in 0.000s                                                                                                                                                                   
Computed supports in 0.044s                                                                                                                                                                                            
Computed factors in 1.578s                                                                                                                                                                                             
Factors size: 46,190                                                                                                                                                                                                   
Computed elimination order in 0.001s                                                                                                                                                                                   
Performed variable_elimination in 0.358s                                                                                                                                                                               
Log-evidence: -9.784628                                                                                                                                                                                                
Finished inference task for N=9 in 1.943s                                                                                                                                                                              
Finished logweight estimation task for N=9 in 0.000s                                                                                                                                                                   
Computed supports in 0.047s                                                                                                                                                                                            
Computed factors in 1.531s                                                                                                                                                                                             
Factors size: 102,522                                                                                                                                                                                                  
Computed elimination order in 0.001s                                                                                                                                                                                   
Performed variable_elimination in 0.379s                                                                                                                                                                               
Log-evidence: -10.279443                                                                                                                                                                                               
Finished inference task for N=10 in 1.916s                                                                                                                                                                             
Finished logweight estimation task for N=10 in 0.000s                                                                                                                                                                  
Computed supports in 0.046s                                                                                                                                                                                            
Computed factors in 1.613s                                                                                                                                                                                             
Factors size: 225,414                                                                                                                                                                                                  
Computed elimination order in 0.001s                                                                                                                                                                                   
Performed variable_elimination in 0.381s                                                                                                                                                                               
Log-evidence: -10.872242                                                                                                                                                                                               
Finished inference task for N=11 in 2.000s                                                                                                                                                                             
Finished logweight estimation task for N=11 in 0.000s                                                                                                                                                                  
Computed supports in 0.045s                                                                                                                                                                                            
Computed factors in 1.690s                                                                                                                                                                                             
Factors size: 491,666                                                                                                                                                                                                  
Computed elimination order in 0.001s                                                                                                                                                                                   
Performed variable_elimination in 0.422s                                                                                                                                                                               
Log-evidence: -11.554104                                                                                                                                                                                               
Finished inference task for N=12 in 2.117s                                                                                                                                                                             
Finished logweight estimation task for N=12 in 0.000s                                                                                                                                                                  
Computed supports in 0.042s                                                                                                                                                                                            
Computed factors in 1.860s                                                                                                                                                                                             
Factors size: 1,065,118                                                                                                                                                                                                
Computed elimination order in 0.002s                                                                                                                                                                                   
Performed variable_elimination in 0.447s                                                                                                                                                                               
Log-evidence: -12.317614                                                                                                                                                                                               
Finished inference task for N=13 in 2.312s                                                                                                                                                                             
Finished logweight estimation task for N=13 in 0.000s                                                                                                                                                                  
Computed supports in 0.043s                                                                                                                                                                                            
Computed factors in 2.009s                                                                                                                                                                                             
Factors size: 2,293,930                                                                                                                                                                                                
Computed elimination order in 0.002s                                                                                                                                                                                   
Performed variable_elimination in 0.476s                                                                                                                                                                               
Log-evidence: -13.156527                                                                                                                                                                                               
Finished inference task for N=14 in 2.492s                                                                                                                                                                             
Finished logweight estimation task for N=14 in 0.000s                                                                                                                                                                  
Computed supports in 0.048s                                                                                                                                                                                            
Computed factors in 2.229s                                                                                                                                                                                             
Factors size: 4,915,382                                                                                                                                                                                                
Computed elimination order in 0.002s                                                                                                                                                                                   
Performed variable_elimination in 0.492s                                                                                                                                                                               
Log-evidence: -14.065473                                                                                                                                                                                               
Finished inference task for N=15 in 2.728s                                                                                                                                                                             
Finished logweight estimation task for N=15 in 0.000s                                                                                                                                                                  
Computed supports in 0.050s                                                                                                                                                                                            
Computed factors in 2.546s                                                                                                                                                                                             
Factors size: 10,485,954                                                                                                                                                                                               
Computed elimination order in 0.002s                                                                                                                                                                                   
Performed variable_elimination in 0.400s                                                                                                                                                                               
Log-evidence: -15.039816                                                                                                                                                                                               
Finished inference task for N=16 in 2.953s                                                                                                                                                                             
Finished logweight estimation task for N=16 in 0.000s                                                                                                                                                                  
Computed supports in 0.049s                                                                                                                                                                                            
Computed factors in 2.412s                                                                                                                                                                                             
Factors size: 22,282,446                                                                                                                                                                                               
Computed elimination order in 0.002s                                                                                                                                                                                   
Performed variable_elimination in 0.423s                                                                                                                                                                               
Log-evidence: -16.075508                                                                                                                                                                                               
Finished inference task for N=17 in 2.844s                                                                                                                                                                             
Finished logweight estimation task for N=17 in 0.000s                                                                                                                                                                  
Computed supports in 0.048s                                                                                                                                                                                            
Computed factors in 2.579s                                                                                                                                                                                             
Factors size: 47,186,138                                                                                                                                                                                               
Computed elimination order in 0.002s                                                                                                                                                                                   
Performed variable_elimination in 0.588s                                                                                                                                                                               
Log-evidence: -17.168951                                                                                                                                                                                               
Finished inference task for N=18 in 3.177s                                                                                                                                                                             
Finished logweight estimation task for N=18 in 0.000s                                                                                                                                                                  
Computed supports in 0.049s                                                                                                                                                                                            
Computed factors in 2.730s                                                                                                                                                                                             
Factors size: 99,614,950                                                                                                                                                                                               
Computed elimination order in 0.003s                                                                                                                                                                                   
Performed variable_elimination in 0.570s                                                                                                                                                                               
Log-evidence: -18.316990                                                                                                                                                                                               
Finished inference task for N=19 in 3.311s                                                                                                                                                                             
Finished logweight estimation task for N=19 in 0.000s                                                                                                                                                                  
Computed supports in 0.053s                                                                                                                                                                                            
Computed factors in 2.807s                                                                                                                                                                                             
Factors size: 209,715,442                                                                                                                                                                                              
Computed elimination order in 0.003s                                                                                                                                                                                   
Performed variable_elimination in 0.599s                                                                                                                                                                               
Log-evidence: -19.516750                                                                                                                                                                                               
Finished inference task for N=20 in 3.420s                                                                                                                                                                             
Finished logweight estimation task for N=20 in 0.000s                                                                                                                                                                  
Computed supports in 0.051s                                                                                                                                                                                            
Computed factors in 3.285s                                                                                                                                                                                             
Factors size: 440,402,174                                                                                                                                                                                              
Computed elimination order in 0.003s                                                                                                                                                                                   
Performed variable_elimination in 0.624s                                                                                                                                                                               
Log-evidence: -20.765684                                                                                                                                                                                               
Finished inference task for N=21 in 3.929s                                                                                                                                                                             
Finished logweight estimation task for N=21 in 0.000s                                                                                                                                                                  
Computed supports in 0.048s                                                                                                                                                                                            
Iteration 1:  84%|                          | 21.0/25 [00:45<00:12,  3.02s/it]
2025-09-29 11:48:48.631957: W external/xla/xla/hlo/transforms/simplifiers/hlo_rematerialization.cc:3183] Can't reduce memory use below 6.48GiB (6962990769 bytes) by rematerialization; only reduced to 15.12GiB (16240345792 bytes), down from 15.12GiB (16240345792 bytes) originally
2025-09-29 11:48:58.916910: W external/xla/xla/tsl/framework/bfc_allocator.cc:501] Allocator (GPU_0_bfc) ran out of memory trying to allocate 352.00MiB (rounded to 369098752)requested by op 
If the cause is memory fragmentation maybe the environment variable 'TF_GPU_ALLOCATOR=cuda_malloc_async' will improve the situation. 
Current allocation summary follows.
Current allocation summary follows.
2025-09-29 11:48:58.917473: W external/xla/xla/tsl/framework/bfc_allocator.cc:512] ****************************************************************************************************
E0929 11:48:58.917505 1264984 pjrt_stream_executor_client.cc:3008] Execution of replica 0 failed: RESOURCE_EXHAUSTED: Out of memory while trying to allocate 369098752 bytes. [tf-allocator-allocation-error='']
Traceback (most recent call last):
  File "/home/markus.h.boeck/DCCxJAX/evaluation/urn/run_comp.py", line 34, in <module>
    result, timings = timed(config.run)(jax.random.key(0))
                      ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/home/markus.h.boeck/DCCxJAX/upix/utils.py", line 205, in wrapped
    out = f(*args, **kwargs)
  File "/home/markus.h.boeck/DCCxJAX/upix/infer/dcc/abstract_dcc.py", line 236, in run
    inference_result = jax.device_get(inference_task.run()) # device_get puts pytree on host (cpu)
                                      ~~~~~~~~~~~~~~~~~~^^
  File "/home/markus.h.boeck/DCCxJAX/upix/infer/dcc/dcc_types.py", line 61, in run
    return self.f(*self.args)
           ~~~~~~^^^^^^^^^^^^
  File "/home/markus.h.boeck/DCCxJAX/upix/infer/dcc/exact_dcc.py", line 113, in _compute_exact
    factors = self.get_factors(slp, supports)
  File "/home/markus.h.boeck/DCCxJAX/evaluation/urn/urn.py", line 59, in get_factors
    return compute_factors_optimised(slp, [selectors], supports, True)
  File "/home/markus.h.boeck/DCCxJAX/upix/infer/exact/factors.py", line 354, in compute_factors_optimised
    result_tables = factor_fn(X)
jaxlib._jax.XlaRuntimeError: RESOURCE_EXHAUSTED: Out of memory while trying to allocate 369098752 bytes.
--------------------
For simplicity, JAX has removed its internal frames from the traceback of the following exception. Set JAX_TRACEBACK_FILTERING=off to include these.
"""

log_a40 = """
Start DCC:
parallelisation=Sequential(local vmap, device=cuda:0)
Make SLP N=1 active.
Make SLP N=2 active.
Make SLP N=3 active.
Make SLP N=4 active.
Make SLP N=5 active.
Make SLP N=6 active.
Make SLP N=7 active.
Make SLP N=8 active.
Make SLP N=9 active.
Make SLP N=10 active.
Make SLP N=11 active.
Make SLP N=12 active.
Make SLP N=13 active.
Make SLP N=14 active.
Make SLP N=15 active.
Make SLP N=16 active.
Make SLP N=17 active.
Make SLP N=18 active.
Make SLP N=19 active.
Make SLP N=20 active.
Make SLP N=21 active.
Make SLP N=22 active.
Make SLP N=23 active.
Make SLP N=24 active.
Make SLP N=25 active.
Initialised SLPs in 9.993s.
Computed supports in 0.152s                                                                                                                                                                                            
Computed factors in 0.741s                                                                                                                                                                                             
Factors size: 34                                                                                                                                                                                                       
Computed elimination order in 0.000s                                                                                                                                                                                   
Performed variable_elimination in 0.334s                                                                                                                                                                               
Log-evidence: -13.371148                                                                                                                                                                                               
Finished inference task for N=1 in 1.079s                                                                                                                                                                              
Finished logweight estimation task for N=1 in 0.000s                                                                                                                                                                   
Computed supports in 0.028s                                                                                                                                                                                            
Computed factors in 0.857s                                                                                                                                                                                             
Factors size: 106                                                                                                                                                                                                      
Computed elimination order in 0.000s                                                                                                                                                                                   
Performed variable_elimination in 0.235s                                                                                                                                                                               
Log-evidence: -10.632257                                                                                                                                                                                               
Finished inference task for N=2 in 1.096s                                                                                                                                                                              
Finished logweight estimation task for N=2 in 0.000s                                                                                                                                                                   
Computed supports in 0.059s                                                                                                                                                                                            
Computed factors in 0.993s                                                                                                                                                                                             
Factors size: 278                                                                                                                                                                                                      
Computed elimination order in 0.000s                                                                                                                                                                                   
Performed variable_elimination in 0.295s                                                                                                                                                                               
Log-evidence: -9.796787                                                                                                                                                                                                
Finished inference task for N=3 in 1.294s                                                                                                                                                                              
Finished logweight estimation task for N=3 in 0.000s                                                                                                                                                                   
Computed supports in 0.069s                                                                                                                                                                                            
Computed factors in 1.102s                                                                                                                                                                                             
Factors size: 690                                                                                                                                                                                                      
Computed elimination order in 0.000s                                                                                                                                                                                   
Performed variable_elimination in 0.287s                                                                                                                                                                               
Log-evidence: -9.298538                                                                                                                                                                                                
Finished inference task for N=4 in 1.394s                                                                                                                                                                              
Finished logweight estimation task for N=4 in 0.000s                                                                                                                                                                   
Computed supports in 0.062s                                                                                                                                                                                            
Computed factors in 1.237s                                                                                                                                                                                             
Factors size: 1,662                                                                                                                                                                                                    
Computed elimination order in 0.001s                                                                                                                                                                                   
Performed variable_elimination in 0.361s                                                                                                                                                                               
Log-evidence: -9.055742                                                                                                                                                                                                
Finished inference task for N=5 in 1.604s                                                                                                                                                                              
Finished logweight estimation task for N=5 in 0.000s                                                                                                                                                                   
Computed supports in 0.065s                                                                                                                                                                                            
Computed factors in 1.312s                                                                                                                                                                                             
Factors size: 3,914                                                                                                                                                                                                    
Computed elimination order in 0.001s                                                                                                                                                                                   
Performed variable_elimination in 0.392s                                                                                                                                                                               
Log-evidence: -9.013157                                                                                                                                                                                                
Finished inference task for N=6 in 1.709s                                                                                                                                                                              
Finished logweight estimation task for N=6 in 0.000s                                                                                                                                                                   
Computed supports in 0.064s                                                                                                                                                                                            
Computed factors in 1.410s                                                                                                                                                                                             
Factors size: 9,046                                                                                                                                                                                                    
Computed elimination order in 0.001s                                                                                                                                                                                   
Performed variable_elimination in 0.445s                                                                                                                                                                               
Log-evidence: -9.135618                                                                                                                                                                                                
Finished inference task for N=7 in 1.860s                                                                                                                                                                              
Finished logweight estimation task for N=7 in 0.000s                                                                                                                                                                   
Computed supports in 0.064s                                                                                                                                                                                            
Computed factors in 1.523s                                                                                                                                                                                             
Factors size: 20,578                                                                                                                                                                                                   
Computed elimination order in 0.001s                                                                                                                                                                                   
Performed variable_elimination in 0.386s                                                                                                                                                                               
Log-evidence: -9.398754                                                                                                                                                                                                
Finished inference task for N=8 in 1.914s                                                                                                                                                                              
Finished logweight estimation task for N=8 in 0.000s                                                                                                                                                                   
Computed supports in 0.068s                                                                                                                                                                                            
Computed factors in 1.794s                                                                                                                                                                                             
Factors size: 46,190                                                                                                                                                                                                   
Computed elimination order in 0.001s                                                                                                                                                                                   
Performed variable_elimination in 0.512s                                                                                                                                                                               
Log-evidence: -9.784628                                                                                                                                                                                                
Finished inference task for N=9 in 2.312s                                                                                                                                                                              
Finished logweight estimation task for N=9 in 0.000s                                                                                                                                                                   
Computed supports in 0.063s                                                                                                                                                                                            
Computed factors in 1.850s                                                                                                                                                                                             
Factors size: 102,522                                                                                                                                                                                                  
Computed elimination order in 0.001s                                                                                                                                                                                   
Performed variable_elimination in 0.549s                                                                                                                                                                               
Log-evidence: -10.279443                                                                                                                                                                                               
Finished inference task for N=10 in 2.405s                                                                                                                                                                             
Finished logweight estimation task for N=10 in 0.000s                                                                                                                                                                  
Computed supports in 0.063s                                                                                                                                                                                            
Computed factors in 1.966s                                                                                                                                                                                             
Factors size: 225,414                                                                                                                                                                                                  
Computed elimination order in 0.002s                                                                                                                                                                                   
Performed variable_elimination in 0.573s                                                                                                                                                                               
Log-evidence: -10.872242                                                                                                                                                                                               
Finished inference task for N=11 in 2.545s                                                                                                                                                                             
Finished logweight estimation task for N=11 in 0.000s                                                                                                                                                                  
Computed supports in 0.067s                                                                                                                                                                                            
Computed factors in 2.110s                                                                                                                                                                                             
Factors size: 491,666                                                                                                                                                                                                  
Computed elimination order in 0.002s                                                                                                                                                                                   
Performed variable_elimination in 0.613s                                                                                                                                                                               
Log-evidence: -11.554104                                                                                                                                                                                               
Finished inference task for N=12 in 2.730s                                                                                                                                                                             
Finished logweight estimation task for N=12 in 0.000s                                                                                                                                                                  
Computed supports in 0.065s                                                                                                                                                                                            
Computed factors in 2.254s                                                                                                                                                                                             
Factors size: 1,065,118                                                                                                                                                                                                
Computed elimination order in 0.002s                                                                                                                                                                                   
Performed variable_elimination in 0.645s                                                                                                                                                                               
Log-evidence: -12.317614                                                                                                                                                                                               
Finished inference task for N=13 in 2.906s                                                                                                                                                                             
Finished logweight estimation task for N=13 in 0.000s                                                                                                                                                                  
Computed supports in 0.069s                                                                                                                                                                                            
Computed factors in 2.448s                                                                                                                                                                                             
Factors size: 2,293,930                                                                                                                                                                                                
Computed elimination order in 0.002s                                                                                                                                                                                   
Performed variable_elimination in 0.684s                                                                                                                                                                               
Log-evidence: -13.156527                                                                                                                                                                                               
Finished inference task for N=14 in 3.139s                                                                                                                                                                             
Finished logweight estimation task for N=14 in 0.000s                                                                                                                                                                  
Computed supports in 0.070s                                                                                                                                                                                            
Computed factors in 2.668s                                                                                                                                                                                             
Factors size: 4,915,382                                                                                                                                                                                                
Computed elimination order in 0.002s                                                                                                                                                                                   
Performed variable_elimination in 0.711s                                                                                                                                                                               
Log-evidence: -14.065472                                                                                                                                                                                               
Finished inference task for N=15 in 3.386s                                                                                                                                                                             
Finished logweight estimation task for N=15 in 0.000s                                                                                                                                                                  
Computed supports in 0.067s                                                                                                                                                                                            
Computed factors in 2.890s                                                                                                                                                                                             
Factors size: 10,485,954                                                                                                                                                                                               
Computed elimination order in 0.003s                                                                                                                                                                                   
Performed variable_elimination in 0.574s                                                                                                                                                                               
Log-evidence: -15.039816                                                                                                                                                                                               
Finished inference task for N=16 in 3.472s                                                                                                                                                                             
Finished logweight estimation task for N=16 in 0.000s                                                                                                                                                                  
Computed supports in 0.068s                                                                                                                                                                                            
Computed factors in 2.972s                                                                                                                                                                                             
Factors size: 22,282,446                                                                                                                                                                                               
Computed elimination order in 0.003s                                                                                                                                                                                   
Performed variable_elimination in 0.731s                                                                                                                                                                               
Log-evidence: -16.075508                                                                                                                                                                                               
Finished inference task for N=17 in 3.711s                                                                                                                                                                             
Finished logweight estimation task for N=17 in 0.000s                                                                                                                                                                  
Computed supports in 0.071s                                                                                                                                                                                            
Computed factors in 3.115s                                                                                                                                                                                             
Factors size: 47,186,138                                                                                                                                                                                               
Computed elimination order in 0.003s                                                                                                                                                                                   
Performed variable_elimination in 0.747s                                                                                                                                                                               
Log-evidence: -17.168951                                                                                                                                                                                               
Finished inference task for N=18 in 3.872s                                                                                                                                                                             
Finished logweight estimation task for N=18 in 0.000s                                                                                                                                                                  
Computed supports in 0.068s                                                                                                                                                                                            
Computed factors in 3.273s                                                                                                                                                                                             
Factors size: 99,614,950                                                                                                                                                                                               
Computed elimination order in 0.003s                                                                                                                                                                                   
Performed variable_elimination in 0.837s                                                                                                                                                                               
Log-evidence: -18.316990                                                                                                                                                                                               
Finished inference task for N=19 in 4.125s                                                                                                                                                                             
Finished logweight estimation task for N=19 in 0.000s                                                                                                                                                                  
Computed supports in 0.067s                                                                                                                                                                                            
Computed factors in 3.432s                                                                                                                                                                                             
Factors size: 209,715,442                                                                                                                                                                                              
Computed elimination order in 0.004s                                                                                                                                                                                   
Performed variable_elimination in 0.873s                                                                                                                                                                               
Log-evidence: -19.516750                                                                                                                                                                                               
Finished inference task for N=20 in 4.325s                                                                                                                                                                             
Finished logweight estimation task for N=20 in 0.000s                                                                                                                                                                  
Computed supports in 0.066s                                                                                                                                                                                            
Computed factors in 3.767s                                                                                                                                                                                             
Factors size: 440,402,174                                                                                                                                                                                              
Computed elimination order in 0.004s                                                                                                                                                                                   
Performed variable_elimination in 0.893s                                                                                                                                                                               
Log-evidence: -20.765684                                                                                                                                                                                               
Finished inference task for N=21 in 4.691s                                                                                                                                                                             
Finished logweight estimation task for N=21 in 0.000s                                                                                                                                                                  
Computed supports in 0.066s                                                                                                                                                                                            
Iteration 1:  84%|                          | 21.0/25 [00:57<00:14,  3.69s/it]
2025-09-29 09:57:52.354855: W external/xla/xla/hlo/transforms/simplifiers/hlo_rematerialization.cc:3183] Can't reduce memory use below 6.52GiB (7005155812 bytes) by rematerialization; only reduced to 15.12GiB (16240345792 bytes), down from 15.12GiB (16240345792 bytes) originally
2025-09-29 09:58:02.776203: W external/xla/xla/tsl/framework/bfc_allocator.cc:501] Allocator (GPU_0_bfc) ran out of memory trying to allocate 352.00MiB (rounded to 369098752)requested by op 
If the cause is memory fragmentation maybe the environment variable 'TF_GPU_ALLOCATOR=cuda_malloc_async' will improve the situation. 
Current allocation summary follows.
Current allocation summary follows.
2025-09-29 09:58:02.776935: W external/xla/xla/tsl/framework/bfc_allocator.cc:512] ***************************************************************************************************_
E0929 09:58:02.777112 1080307 pjrt_stream_executor_client.cc:3008] Execution of replica 0 failed: RESOURCE_EXHAUSTED: Out of memory while trying to allocate 369098752 bytes. [tf-allocator-allocation-error='']
Traceback (most recent call last):
  File "/home/markus.h.boeck/DCCxJAX/evaluation/urn/run_comp.py", line 34, in <module>
    result, timings = timed(config.run)(jax.random.key(0))
                      ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/home/markus.h.boeck/DCCxJAX/upix/utils.py", line 205, in wrapped
    out = f(*args, **kwargs)
  File "/home/markus.h.boeck/DCCxJAX/upix/infer/dcc/abstract_dcc.py", line 236, in run
    inference_result = jax.device_get(inference_task.run()) # device_get puts pytree on host (cpu)
                                      ~~~~~~~~~~~~~~~~~~^^
  File "/home/markus.h.boeck/DCCxJAX/upix/infer/dcc/dcc_types.py", line 61, in run
    return self.f(*self.args)
           ~~~~~~^^^^^^^^^^^^
  File "/home/markus.h.boeck/DCCxJAX/upix/infer/dcc/exact_dcc.py", line 113, in _compute_exact
    factors = self.get_factors(slp, supports)
  File "/home/markus.h.boeck/DCCxJAX/evaluation/urn/urn.py", line 59, in get_factors
    return compute_factors_optimised(slp, [selectors], supports, True)
  File "/home/markus.h.boeck/DCCxJAX/upix/infer/exact/factors.py", line 354, in compute_factors_optimised
    result_tables = factor_fn(X)
jaxlib._jax.XlaRuntimeError: RESOURCE_EXHAUSTED: Out of memory while trying to allocate 369098752 bytes.
--------------------
For simplicity, JAX has removed its internal frames from the traceback of the following exception. Set JAX_TRACEBACK_FILTERING=off to include these.
"""

log_a100 = """
Start DCC:
parallelisation=Sequential(local vmap, device=cuda:0)
Make SLP N=1 active.
Make SLP N=2 active.
Make SLP N=3 active.
Make SLP N=4 active.
Make SLP N=5 active.
Make SLP N=6 active.
Make SLP N=7 active.
Make SLP N=8 active.
Make SLP N=9 active.
Make SLP N=10 active.
Make SLP N=11 active.
Make SLP N=12 active.
Make SLP N=13 active.
Make SLP N=14 active.
Make SLP N=15 active.
Make SLP N=16 active.
Make SLP N=17 active.
Make SLP N=18 active.
Make SLP N=19 active.
Make SLP N=20 active.
Make SLP N=21 active.
Make SLP N=22 active.
Make SLP N=23 active.
Make SLP N=24 active.
Make SLP N=25 active.
Initialised SLPs in 8.525s.
Computed supports in 0.125s                                                                                                                                                                                            
Computed factors in 0.631s                                                                                                                                                                                             
Factors size: 34                                                                                                                                                                                                       
Computed elimination order in 0.000s                                                                                                                                                                                   
Performed variable_elimination in 0.175s                                                                                                                                                                               
Log-evidence: -13.371148                                                                                                                                                                                               
Finished inference task for N=1 in 0.810s                                                                                                                                                                              
Finished logweight estimation task for N=1 in 0.000s                                                                                                                                                                   
Computed supports in 0.027s                                                                                                                                                                                            
Computed factors in 0.732s                                                                                                                                                                                             
Factors size: 106                                                                                                                                                                                                      
Computed elimination order in 0.000s                                                                                                                                                                                   
Performed variable_elimination in 0.196s                                                                                                                                                                               
Log-evidence: -10.632257                                                                                                                                                                                               
Finished inference task for N=2 in 0.932s                                                                                                                                                                              
Finished logweight estimation task for N=2 in 0.000s                                                                                                                                                                   
Computed supports in 0.052s                                                                                                                                                                                            
Computed factors in 0.810s                                                                                                                                                                                             
Factors size: 278                                                                                                                                                                                                      
Computed elimination order in 0.000s                                                                                                                                                                                   
Performed variable_elimination in 0.235s                                                                                                                                                                               
Log-evidence: -9.796787                                                                                                                                                                                                
Finished inference task for N=3 in 1.049s                                                                                                                                                                              
Finished logweight estimation task for N=3 in 0.000s                                                                                                                                                                   
Computed supports in 0.053s                                                                                                                                                                                            
Computed factors in 0.912s                                                                                                                                                                                             
Factors size: 690                                                                                                                                                                                                      
Computed elimination order in 0.000s                                                                                                                                                                                   
Performed variable_elimination in 0.239s                                                                                                                                                                               
Log-evidence: -9.298538                                                                                                                                                                                                
Finished inference task for N=4 in 1.155s                                                                                                                                                                              
Finished logweight estimation task for N=4 in 0.000s                                                                                                                                                                   
Computed supports in 0.052s                                                                                                                                                                                            
Computed factors in 0.994s                                                                                                                                                                                             
Factors size: 1,662                                                                                                                                                                                                    
Computed elimination order in 0.000s                                                                                                                                                                                   
Performed variable_elimination in 0.286s                                                                                                                                                                               
Log-evidence: -9.055742                                                                                                                                                                                                
Finished inference task for N=5 in 1.283s                                                                                                                                                                              
Finished logweight estimation task for N=5 in 0.000s                                                                                                                                                                   
Computed supports in 0.054s                                                                                                                                                                                            
Computed factors in 1.104s                                                                                                                                                                                             
Factors size: 3,914                                                                                                                                                                                                    
Computed elimination order in 0.001s                                                                                                                                                                                   
Performed variable_elimination in 0.320s                                                                                                                                                                               
Log-evidence: -9.013157                                                                                                                                                                                                
Finished inference task for N=6 in 1.428s                                                                                                                                                                              
Finished logweight estimation task for N=6 in 0.000s                                                                                                                                                                   
Computed supports in 0.055s                                                                                                                                                                                            
Computed factors in 1.191s                                                                                                                                                                                             
Factors size: 9,046                                                                                                                                                                                                    
Computed elimination order in 0.001s                                                                                                                                                                                   
Performed variable_elimination in 0.368s                                                                                                                                                                               
Log-evidence: -9.135618                                                                                                                                                                                                
Finished inference task for N=7 in 1.563s                                                                                                                                                                              
Finished logweight estimation task for N=7 in 0.000s                                                                                                                                                                   
Computed supports in 0.059s                                                                                                                                                                                            
Computed factors in 1.333s                                                                                                                                                                                             
Factors size: 20,578                                                                                                                                                                                                   
Computed elimination order in 0.001s                                                                                                                                                                                   
Performed variable_elimination in 0.319s                                                                                                                                                                               
Log-evidence: -9.398754                                                                                                                                                                                                
Finished inference task for N=8 in 1.657s                                                                                                                                                                              
Finished logweight estimation task for N=8 in 0.000s                                                                                                                                                                   
Computed supports in 0.057s                                                                                                                                                                                            
Computed factors in 1.555s                                                                                                                                                                                             
Factors size: 46,190                                                                                                                                                                                                   
Computed elimination order in 0.001s                                                                                                                                                                                   
Performed variable_elimination in 0.419s                                                                                                                                                                               
Log-evidence: -9.784628                                                                                                                                                                                                
Finished inference task for N=9 in 1.979s                                                                                                                                                                              
Finished logweight estimation task for N=9 in 0.000s                                                                                                                                                                   
Computed supports in 0.057s                                                                                                                                                                                            
Computed factors in 1.513s                                                                                                                                                                                             
Factors size: 102,522                                                                                                                                                                                                  
Computed elimination order in 0.001s                                                                                                                                                                                   
Performed variable_elimination in 0.441s                                                                                                                                                                               
Log-evidence: -10.279443                                                                                                                                                                                               
Finished inference task for N=10 in 1.959s                                                                                                                                                                             
Finished logweight estimation task for N=10 in 0.000s                                                                                                                                                                  
Computed supports in 0.056s                                                                                                                                                                                            
Computed factors in 1.692s                                                                                                                                                                                             
Factors size: 225,414                                                                                                                                                                                                  
Computed elimination order in 0.001s                                                                                                                                                                                   
Performed variable_elimination in 0.469s                                                                                                                                                                               
Log-evidence: -10.872242                                                                                                                                                                                               
Finished inference task for N=11 in 2.166s                                                                                                                                                                             
Finished logweight estimation task for N=11 in 0.000s                                                                                                                                                                  
Computed supports in 0.058s                                                                                                                                                                                            
Computed factors in 1.804s                                                                                                                                                                                             
Factors size: 491,666                                                                                                                                                                                                  
Computed elimination order in 0.001s                                                                                                                                                                                   
Performed variable_elimination in 0.471s                                                                                                                                                                               
Log-evidence: -11.554104                                                                                                                                                                                               
Finished inference task for N=12 in 2.281s                                                                                                                                                                             
Finished logweight estimation task for N=12 in 0.000s                                                                                                                                                                  
Computed supports in 0.053s                                                                                                                                                                                            
Computed factors in 1.902s                                                                                                                                                                                             
Factors size: 1,065,118                                                                                                                                                                                                
Computed elimination order in 0.002s                                                                                                                                                                                   
Performed variable_elimination in 0.505s                                                                                                                                                                               
Log-evidence: -12.317614                                                                                                                                                                                               
Finished inference task for N=13 in 2.413s                                                                                                                                                                             
Finished logweight estimation task for N=13 in 0.000s                                                                                                                                                                  
Computed supports in 0.055s                                                                                                                                                                                            
Computed factors in 2.053s                                                                                                                                                                                             
Factors size: 2,293,930                                                                                                                                                                                                
Computed elimination order in 0.002s                                                                                                                                                                                   
Performed variable_elimination in 0.556s                                                                                                                                                                               
Log-evidence: -13.156527                                                                                                                                                                                               
Finished inference task for N=14 in 2.615s                                                                                                                                                                             
Finished logweight estimation task for N=14 in 0.000s                                                                                                                                                                  
Computed supports in 0.069s                                                                                                                                                                                            
Computed factors in 2.204s                                                                                                                                                                                             
Factors size: 4,915,382                                                                                                                                                                                                
Computed elimination order in 0.002s                                                                                                                                                                                   
Performed variable_elimination in 0.572s                                                                                                                                                                               
Log-evidence: -14.065472                                                                                                                                                                                               
Finished inference task for N=15 in 2.783s                                                                                                                                                                             
Finished logweight estimation task for N=15 in 0.000s                                                                                                                                                                  
Computed supports in 0.059s                                                                                                                                                                                            
Computed factors in 2.616s                                                                                                                                                                                             
Factors size: 10,485,954                                                                                                                                                                                               
Computed elimination order in 0.002s                                                                                                                                                                                   
Performed variable_elimination in 0.460s                                                                                                                                                                               
Log-evidence: -15.039816                                                                                                                                                                                               
Finished inference task for N=16 in 3.083s                                                                                                                                                                             
Finished logweight estimation task for N=16 in 0.000s                                                                                                                                                                  
Computed supports in 0.056s                                                                                                                                                                                            
Computed factors in 2.573s                                                                                                                                                                                             
Factors size: 22,282,446                                                                                                                                                                                               
Computed elimination order in 0.002s                                                                                                                                                                                   
Performed variable_elimination in 0.516s                                                                                                                                                                               
Log-evidence: -16.075506                                                                                                                                                                                               
Finished inference task for N=17 in 3.097s                                                                                                                                                                             
Finished logweight estimation task for N=17 in 0.000s                                                                                                                                                                  
Computed supports in 0.059s                                                                                                                                                                                            
Computed factors in 2.735s                                                                                                                                                                                             
Factors size: 47,186,138                                                                                                                                                                                               
Computed elimination order in 0.003s                                                                                                                                                                                   
Performed variable_elimination in 0.692s                                                                                                                                                                               
Log-evidence: -17.168951                                                                                                                                                                                               
Finished inference task for N=18 in 3.435s                                                                                                                                                                             
Finished logweight estimation task for N=18 in 0.000s                                                                                                                                                                  
Computed supports in 0.063s                                                                                                                                                                                            
Computed factors in 2.887s                                                                                                                                                                                             
Factors size: 99,614,950                                                                                                                                                                                               
Computed elimination order in 0.003s                                                                                                                                                                                   
Performed variable_elimination in 0.699s                                                                                                                                                                               
Log-evidence: -18.316990                                                                                                                                                                                               
Finished inference task for N=19 in 3.595s                                                                                                                                                                             
Finished logweight estimation task for N=19 in 0.000s                                                                                                                                                                  
Computed supports in 0.061s                                                                                                                                                                                            
Computed factors in 2.987s                                                                                                                                                                                             
Factors size: 209,715,442                                                                                                                                                                                              
Computed elimination order in 0.003s                                                                                                                                                                                   
Performed variable_elimination in 0.813s                                                                                                                                                                               
Log-evidence: -19.516750                                                                                                                                                                                               
Finished inference task for N=20 in 3.810s                                                                                                                                                                             
Finished logweight estimation task for N=20 in 0.000s                                                                                                                                                                  
Computed supports in 0.059s                                                                                                                                                                                            
Computed factors in 3.352s                                                                                                                                                                                             
Factors size: 440,402,174                                                                                                                                                                                              
Computed elimination order in 0.003s                                                                                                                                                                                   
Performed variable_elimination in 0.774s                                                                                                                                                                               
Log-evidence: -20.765684                                                                                                                                                                                               
Finished inference task for N=21 in 4.138s                                                                                                                                                                             
Finished logweight estimation task for N=21 in 0.000s                                                                                                                                                                  
Computed supports in 0.057s                                                                                                                                                                                            
Computed factors in 3.291s                                                                                                                                                                                             
Factors size: 922,747,146                                                                                                                                                                                              
Computed elimination order in 0.004s                                                                                                                                                                                   
Performed variable_elimination in 0.885s                                                                                                                                                                               
Log-evidence: -22.061470                                                                                                                                                                                               
Finished inference task for N=22 in 4.195s                                                                                                                                                                             
Finished logweight estimation task for N=22 in 0.000s                                                                                                                                                                  
Computed supports in 0.063s                                                                                                                                                                                            
Iteration 1:  88%|                   | 22.0/25 [00:52<00:10,  3.38s/it]
2025-09-29 09:59:48.782715: W external/xla/xla/hlo/transforms/simplifiers/hlo_rematerialization.cc:3183] Can't reduce memory use below 2.53GiB (2712321706 bytes) by rematerialization; only reduced to 32.34GiB (34728837840 bytes), down from 32.34GiB (34728837840 bytes) originally
2025-09-29 09:59:59.107741: W external/xla/xla/tsl/framework/bfc_allocator.cc:501] Allocator (GPU_0_bfc) ran out of memory trying to allocate 736.00MiB (rounded to 771751936)requested by op 
If the cause is memory fragmentation maybe the environment variable 'TF_GPU_ALLOCATOR=cuda_malloc_async' will improve the situation. 
Current allocation summary follows.
Current allocation summary follows.
2025-09-29 09:59:59.108076: W external/xla/xla/tsl/framework/bfc_allocator.cc:512] ****************************************************************************************************
E0929 09:59:59.108105 1481872 pjrt_stream_executor_client.cc:3008] Execution of replica 0 failed: RESOURCE_EXHAUSTED: Out of memory while trying to allocate 771751936 bytes. [tf-allocator-allocation-error='']
Traceback (most recent call last):
  File "/home/markus.h.boeck/DCCxJAX/evaluation/urn/run_comp.py", line 34, in <module>
    result, timings = timed(config.run)(jax.random.key(0))
                      ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/home/markus.h.boeck/DCCxJAX/upix/utils.py", line 205, in wrapped
    out = f(*args, **kwargs)
  File "/home/markus.h.boeck/DCCxJAX/upix/infer/dcc/abstract_dcc.py", line 236, in run
    inference_result = jax.device_get(inference_task.run()) # device_get puts pytree on host (cpu)
                                      ~~~~~~~~~~~~~~~~~~^^
  File "/home/markus.h.boeck/DCCxJAX/upix/infer/dcc/dcc_types.py", line 61, in run
    return self.f(*self.args)
           ~~~~~~^^^^^^^^^^^^
  File "/home/markus.h.boeck/DCCxJAX/upix/infer/dcc/exact_dcc.py", line 113, in _compute_exact
    factors = self.get_factors(slp, supports)
  File "/home/markus.h.boeck/DCCxJAX/evaluation/urn/urn.py", line 59, in get_factors
    return compute_factors_optimised(slp, [selectors], supports, True)
  File "/home/markus.h.boeck/DCCxJAX/upix/infer/exact/factors.py", line 354, in compute_factors_optimised
    result_tables = factor_fn(X)
jaxlib._jax.XlaRuntimeError: RESOURCE_EXHAUSTED: Out of memory while trying to allocate 771751936 bytes.
--------------------
For simplicity, JAX has removed its internal frames from the traceback of the following exception. Set JAX_TRACEBACK_FILTERING=off to include these.
"""

import re
import matplotlib.pyplot as plt

time = [float(t) for t in re.findall(r"Finished inference task for N=\d+ in (\d+.\d+)s", log_cpu)]
l40s_time = [float(t) for t in re.findall(r"Finished inference task for N=\d+ in (\d+.\d+)s", log_l40s)]
a40_time = [float(t) for t in re.findall(r"Finished inference task for N=\d+ in (\d+.\d+)s", log_a40)]
a100_time = [float(t) for t in re.findall(r"Finished inference task for N=\d+ in (\d+.\d+)s", log_a100)]
factors_size = [int(f.replace(",","")) for f in re.findall(r"Factors size: ([\d,]+)", log_cpu)]
    
M = ["o", "^", "s", "D"]

fig, ax1 = plt.subplots(figsize=(5,2.5))

ax1.set_xlabel('number of balls in urn')
ax1.set_ylabel('time [s]')
ax1.set_yscale("log")
ax1.plot(time, marker=M[0], label="AMD EPYC 9355 256GB", zorder=3, alpha=0.5, color="tab:red")
# ax1.plot(a40_time, marker=M[2], label="A40 48GB", zorder=3, alpha=0.5)
ax1.plot(a100_time, marker=M[3], label="A100 80GB", zorder=3, alpha=0.5, color="tab:orange")
ax1.plot(l40s_time, marker=M[1], label="L40s 48GB", zorder=3, alpha=0.5, color="tab:blue")
leg = ax1.legend()
leg.get_frame().set_linewidth(0.0)
leg.get_frame().set_facecolor('none')
ax1.set_yticks([1,10], ["1", "10"], minor=False)
ax2 = ax1.twinx()

ax2.set_ylabel('sum of factor sizes', rotation=270, labelpad=14)
ax2.set_yscale("log")
ax2.plot(factors_size, marker=M[2], label="factor size", color="tab:gray", zorder=1, alpha=0.5)
ax2.tick_params(axis='y')
leg = ax2.legend(loc="lower right")
leg.get_frame().set_linewidth(0.0)
leg.get_frame().set_facecolor('none')
ax1.set_zorder(ax2.get_zorder()+1)
ax1.patch.set_visible(False)  # Make background transparent

fig.tight_layout()
plt.savefig("factor_size_scaling.pdf")
plt.show()